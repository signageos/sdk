include:
  - project: "signageos/infra/gitlab-ci"
    file: "/pipelines/ts-lib-public.yaml"
    ref: master

test:e2e:
  extends: .test:general
  rules:
    # Skip on tag
    - if: $CI_COMMIT_TAG
      when: never
    - when: manual
      allow_failure: true
  variables:
    TEST_TARGET: "test:e2e"

# Custom documentation publishing to S3
publish:docs:
  extends: .build:build-npm-package
  stage: release
  rules:
    - if: $CI_COMMIT_TAG
    - when: manual
      allow_failure: true
  environment:
    name: docs
    url: https://public.docs.signageos.io/sdk/latest/index.html
  script:
    - docker-gitlabci-run npm run docs
    - aws s3 cp ./docs "s3://signageos-documentation/sdk/$CI_COMMIT_TAG" --recursive
